<turbo-frame id="<%= dom_id(todo) %>" class="group">
  <li class="flex items-center justify-between gap-6 px-6 py-4 border-b hover:bg-gray-50 transition-colors">

    <!-- ハンドルとチェックボックス -->
    <div class="flex items-center space-x-3 shrink-0">
      <!-- 6点ハンドル（より左に寄せる） -->
      <div class="w-4 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-move">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
          <path d="M2 4a2 2 0 114 0 2 2 0 01-4 0zM2 10a2 2 0 114 0 2 2 0 01-4 0zM2 16a2 2 0 114 0 2 2 0 01-4 0zM8 4a2 2 0 114 0 2 2 0 01-4 0zM8 10a2 2 0 114 0 2 2 0 01-4 0zM8 16a2 2 0 114 0 2 2 0 01-4 0z"/>
        </svg>
      </div>

      <!-- チェックボタン -->
      <%= form_with model: todo,
                    data: { "turbo-method": :patch,
                            turbo_frame: "#{dom_id(todo)}",
                            controller: "done-button-submit"  }, 
                   class: "shrink-0" do |f| %>
        <%= hidden_field_tag :source, source %>
        <%= f.check_box :done, 
                        data: { action: "change->done-button-submit#submit"},
                        class: "w-6 h-6 text-blue-500 border-gray-300 rounded focus:ring-blue-400"  %>
      <% end %>
    </div>

    <!-- 本文（タイトル・説明・日付） -->
    <div class="flex-1  min-w-0 mx-4 <%= 'opacity-50 line-through' if todo.done? %> ">
      <p class="text-base font-semibold text-gray-800"><%= todo.title %></p>

      <% if todo.description.present? %>
        <details class="mt-1">
          <summary class="text-sm text-gray-500 cursor-pointer">詳細</summary>
          <p class="text-sm text-gray-600 mt-1 whitespace-pre-wrap"><%= todo.description %></p>
        </details>
      <% end %>

      <% if todo.due_at.present? %>
        <div class="flex items-center text-sm text-red-500 mt-1">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2z" />
          </svg>
          <%= todo.due_at.in_time_zone.strftime("%-H:%M") %>
        </div>
      <% end %>
    </div>

    <!-- 右の縦3点メニュー -->
    <details class="relative ml-2 shrink-0">
      <summary class="w-7 h-7 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500 hover:text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 6v.01M12 12v.01M12 18v.01"/>
        </svg>
      </summary>
      <ul class="absolute right-0 mt-2 w-36 bg-white border rounded shadow-lg z-10">
        <li>
          <%= button_to "削除", todo_path(todo),
                method: :delete,
                form: { data: { turbo_confirm: "本当に削除しますか？" } },
                class: "block w-full text-left px-4 py-2 hover:bg-gray-100" %>
        </li>
        <li>
          <%= button_to "複製", "#",
                method: :post,
                class: "block w-full text-left px-4 py-2 hover:bg-gray-100" %>
        </li>
      </ul>
    </details>

  </li>
</turbo-frame>
